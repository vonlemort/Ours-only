<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Me & The love of my life's Website</title>
  <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@300;500;700&display=swap" rel="stylesheet">
  <style>
    :root{--bg1:#fff6fb;--accent:#ff6fa6;--muted:#7a3a4f;--paper:#fffecb}
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:'Quicksand',system-ui,Arial;background:linear-gradient(180deg,var(--bg1),#fff);overflow-x:hidden}

    /* ---- Gate ---- */
    .gateWrap{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:linear-gradient(180deg,#fff0fb,#fff);z-index:80}
    .gateCard{width:100%;max-width:520px;padding:32px;border-radius:18px;background:linear-gradient(180deg,#fff,#fff8fb);box-shadow:0 20px 50px rgba(255,111,160,0.15);text-align:center;animation:pop .6s ease}
    .lockBig{font-size:80px;animation:pulse 2s infinite}
    .codeInput{width:100%;padding:14px;border-radius:12px;border:2px solid rgba(255,111,160,0.14);font-size:18px;margin-top:16px}
    .btn{padding:12px 18px;border-radius:12px;border:none;background:var(--accent);color:white;font-weight:700;cursor:pointer;margin-top:12px;transition:transform .2s}
    .btn:hover{transform:scale(1.05)}
    @keyframes pulse{0%,100%{transform:scale(1)}50%{transform:scale(1.08)}}
    @keyframes pop{0%{transform:scale(.9);opacity:0}100%{transform:scale(1);opacity:1}}

    /* ---- App / Hub ---- */
    .app{display:none;position:relative;z-index:2;min-height:100vh;width:100%;flex-direction:column;align-items:center}
    .hub{min-height:70vh;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:24px;text-align:center;padding-top:60px}
    .title{font-size:46px;color:var(--accent);margin:0;text-shadow:0 2px 0 #fff,0 10px 30px rgba(255,111,160,.25)}
    .subtitle{color:var(--muted);max-width:720px;margin:0}
    .bigBtns{display:flex;gap:16px;flex-wrap:wrap;justify-content:center;margin-top:10px}
    .bigBtn{width:260px;height:180px;border-radius:18px;background:linear-gradient(180deg,#fff,#fff0fb);display:flex;flex-direction:column;align-items:center;justify-content:center;box-shadow:0 12px 36px rgba(0,0,0,0.06);cursor:pointer;transition:transform .2s;position:relative;padding:12px}
    .bigBtn .label{font-weight:800;margin-top:6px}
    .bigBtn .desc{font-size:13px;color:var(--muted);max-width:220px;opacity:.9;margin-top:6px}
    .bigBtn:hover{transform:scale(1.05)}

    main{width:100%;padding:22px 16px;display:flex;flex-direction:column;align-items:center}
    .page{display:none;min-height:60vh;width:100%;max-width:1100px}
    .page.active{display:block}
    .backRow{display:flex;justify-content:center}
    .backBtn{margin:8px 0 18px;padding:10px 16px;border:none;border-radius:12px;background:var(--accent);color:white;cursor:pointer;transition:transform .2s}
    .backBtn:hover{transform:scale(1.05)}

    /* ---- Animated background ---- */
    .floatingBg span{position:fixed;pointer-events:none;z-index:0;animation:float 6s ease-in-out infinite;opacity:0.4}
    @keyframes float{0%{transform:translateY(0)}50%{transform:translateY(-18px)}100%{transform:translateY(0)}}

    /* ---- Notes (sticky + red pin + date + scroll) ---- */
    .noteInputRow{display:flex;justify-content:center;gap:8px;margin-bottom:14px;flex-wrap:wrap}
    .noteInputRow input{padding:10px;border-radius:10px;border:1px solid #d9c6cf;min-width:320px}
    .notesBoard{display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:18px;background:linear-gradient(180deg,#fff0fb,#fff);padding:20px;border-radius:14px}
    .noteCard{position:relative;display:flex;flex-direction:column;background:var(--paper);padding:26px 18px 12px;border-radius:10px;min-height:160px;max-width:360px;box-shadow:0 8px 22px rgba(0,0,0,0.15);transform:rotate(calc(-3deg + 6deg * var(--r)));overflow:visible}
    .noteCard p{margin:0;font-size:15px;color:#6c3446;white-space:pre-wrap;word-break:break-word;overflow-wrap:anywhere;line-height:1.45}
    .noteCard small{display:block;color:#8b6b73;font-size:12px}
    .pin{position:absolute;top:-14px;left:50%;transform:translateX(-50%);width:18px;height:18px;background:#e84343;border-radius:50%;box-shadow:0 3px 0 0 #b82e2e, 0 10px 14px rgba(0,0,0,0.25);z-index:1}
    .pin:after{content:"";position:absolute;inset:5px;width:8px;height:8px;background:#ff9a9a;border-radius:50%}
    .noteBody{flex:1;max-height:220px;overflow:auto}
    .noteFooter{margin-top:10px;padding-top:8px;border-top:1px dashed #e0cbd3;display:flex;justify-content:space-between;align-items:center}
    .delBtn{border:none;background:#fff;color:#c0392b;font-weight:700;padding:6px 8px;border-radius:8px;cursor:pointer;box-shadow:0 1px 3px rgba(0,0,0,.1)}
    .delBtn:hover{ background:#ffe6ea }

    /* ---- Songs grid + cards (floating glass covers) ---- */
    .songsGrid{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:18px}
    @keyframes slowFloat{0%{transform:translateY(0)}50%{transform:translateY(-8px)}100%{transform:translateY(0)}}
    .songCard{position:relative;background:#fff;border-radius:12px;box-shadow:0 10px 30px rgba(0,0,0,0.08);padding:12px;text-align:center;animation:slowFloat 8s ease-in-out infinite;animation-delay:var(--d,0s)}
    .songCard:nth-child(2n){--d:1s}
    .songCard:nth-child(3n){--d:2s}
    .songCard:nth-child(4n){--d:3s}
    .cover{
      position:relative;width:150px;height:150px;border-radius:14px;overflow:hidden;margin:6px auto;
      border:2px solid rgba(255,255,255,0.8);
      box-shadow:0 8px 26px rgba(255,111,166,0.2), inset 0 0 0 1px rgba(255,255,255,0.5);
      background:#fff;
    }
    .cover img{width:100%;height:100%;object-fit:cover}
    .cover:before{
      content:"";position:absolute;left:-10%;top:-20%;width:140%;height:50%;
      background:linear-gradient( to bottom, rgba(255,255,255,.65), rgba(255,255,255,0) );
      transform:rotate(12deg);pointer-events:none;
    }
    .cover:after{content:"";position:absolute;inset:0;pointer-events:none;box-shadow:inset 0 0 30px rgba(255,255,255,.15)}
    .songTitle{font-weight:700;color:var(--muted)}
    .playBtn{margin-top:8px;padding:8px 12px;border-radius:10px;border:none;background:var(--accent);color:#fff;cursor:pointer}

    /* ---- Custom audio player (pink, round, cute) ---- */
    .audioWrap{display:flex;justify-content:center}
    .audioPlayer{
      width:100%;max-width:720px;margin:16px auto 0;
      background:linear-gradient(180deg,#fff,#fff7fb);
      border:2px solid rgba(255,111,166,0.15);
      border-radius:22px;padding:12px 16px;
      box-shadow:0 12px 28px rgba(255,111,166,0.18);
      display:grid;grid-template-columns:auto 1fr auto;gap:14px;align-items:center;
    }
    .ap-cover{
      width:56px;height:56px;border-radius:50%;overflow:hidden;box-shadow:0 6px 16px rgba(255,111,166,.35);display:flex;align-items:center;justify-content:center;background:#fff
    }
    .ap-cover img{width:100%;height:100%;object-fit:cover}
    .ap-main{display:flex;flex-direction:column;gap:8px}
    .ap-title{font-weight:800;color:var(--muted);line-height:1}
    .ap-time{font-size:12px;color:#8b6b73}
    .ap-bar{height:10px;border-radius:999px;background:rgba(255,111,166,.18);position:relative;cursor:pointer;overflow:hidden}
    .ap-fill{position:absolute;left:0;top:0;height:100%;width:0%;background:var(--accent);border-radius:999px;box-shadow:0 2px 8px rgba(255,111,166,0.4)}
    .ap-ctrls{display:flex;gap:8px}
    .ap-btn{
      border:none;background:var(--accent);color:#fff;font-weight:800;
      width:44px;height:44px;border-radius:50%;cursor:pointer;
      box-shadow:0 6px 16px rgba(255,111,166,0.35);display:flex;align-items:center;justify-content:center;font-size:16px
    }
    .ap-btn:active{transform:scale(.98)}

    /* ---- Photos (polaroid wall + categories) ---- */
    .photosWall{background:linear-gradient(180deg,#fff0fb,#fff);border-radius:14px;padding:18px}
    .polaroidGrid{display:grid;grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:22px;align-items:start}
    .polaroid{
      position:relative;width:100%;padding:12px 12px 38px;background:#fff;border-radius:10px;border:10px solid #fff;
      box-shadow:0 14px 26px rgba(0,0,0,0.16), 0 2px 6px rgba(0,0,0,0.08);
      transform:rotate(calc(-3deg + 6deg*var(--rot, .5)));transition:transform .22s;margin-top:var(--mt,0);
    }
    .polaroid:hover{transform:rotate(0deg) scale(1.02)}
    .polaroid img, .polaroid video{width:100%;height:190px;object-fit:cover;border-radius:6px}
    .polaroid .caption{position:absolute;left:0;right:0;bottom:6px;text-align:center;font-size:12px;color:#8b6b73}
    .polaroid:nth-child(2n){--mt:6px}
    .polaroid:nth-child(3n){--mt:18px}
    .polaroid:nth-child(4n){--mt:10px}
    .polaroid:nth-child(5n){--mt:24px}

    .photoCats{display:flex;gap:16px;flex-wrap:wrap;justify-content:center;margin:10px 0 18px}
    .photoBtn{width:240px;height:120px;border-radius:16px;background:linear-gradient(180deg,#fff,#fff0fb);display:flex;flex-direction:column;align-items:center;justify-content:center;box-shadow:0 12px 36px rgba(0,0,0,0.06);cursor:pointer;transition:transform .2s;padding:10px}
    .photoBtn .label{font-weight:800}
    .photoBtn .desc{font-size:12px;color:var(--muted);max-width:210px;margin-top:4px}
    .photoBtn:hover{transform:scale(1.05)}

    /* ---- Cute footer (Hello Kitty + lilies) ‚Äì hub only ---- */
    .cuteFooter{position:fixed;left:0;right:0;bottom:8px;display:none;align-items:center;justify-content:center;gap:14px;pointer-events:none;z-index:3}
    .kitty{width:64px;height:64px;animation:kittyWalk 10s linear infinite}
    .lily{width:20px;height:20px;opacity:.9;animation:slowFloat 7s ease-in-out infinite}
    @keyframes kittyWalk{0%{transform:translateX(-40vw)}50%{transform:translateX(0)}100%{transform:translateX(40vw)}}
  </style>

  <!-- Firebase SDKs (Compat for simple usage) -->
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-database-compat.js"></script>
</head>
<body>
  <!-- animated sparkle layer -->
  <div class="floatingBg" id="floatingBg"></div>

  <!-- Gate -->
  <div class="gateWrap" id="gateWrap">
    <div class="gateCard">
      <div class="lockBig">üîí</div>
      <h2>Enter our secret code</h2>
      <p style="color:var(--muted)">Only Khadeja and Saleh know the secret code</p>
      <input id="codeField" class="codeInput" placeholder="Type the secret code..." autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false">
      <button id="submitCode" class="btn">Unlock Love üíû</button>
      <p id="gateMsg" style="color:crimson;margin-top:10px"></p>
    </div>
  </div>

  <!-- App shell -->
  <div class="app" id="appShell"></div>

  <!-- HUB footer decorations (hub only) -->
  <div class="cuteFooter" id="cuteFooter">
    <img class="lily" src="assets/lilies.png" alt="lily" onerror="this.style.display='none'"/>
    <img class="kitty" src="assets/hello-kitty.gif" alt="Hello Kitty" onerror="this.style.display='none'"/>
    <img class="lily" src="assets/lilies.png" alt="lily" onerror="this.style.display='none'"/>
  </div>

  <!-- Lightbox for photos/videos -->
  <div id="lightbox" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,.4);backdrop-filter:blur(2px);z-index:90;align-items:center;justify-content:center;padding:16px">
    <div id="lightboxInner" style="max-width:90vw;max-height:90vh;background:#fff;border:12px solid #fff;border-radius:12px;box-shadow:0 30px 60px rgba(0,0,0,.25);position:relative;padding:10px 10px 36px">
      <button id="lbClose" style="position:absolute;right:8px;top:8px;border:none;background:var(--accent);color:#fff;border-radius:10px;padding:6px 10px;cursor:pointer">Close</button>
      <div id="lbContent" style="width:72vw;max-width:820px;max-height:72vh;display:flex;align-items:center;justify-content:center"></div>
    </div>
  </div>

  <script>
    // ===== Helper: safe HTML =====
    function escapeHtml(s){
      return String(s)
        .replace(/&/g,'&amp;')
        .replace(/</g,'&lt;')
        .replace(/>/g,'&gt;')
        .replace(/\n/g,'<br>');
    }
    function coverFallback(img){
      const svg = encodeURIComponent(`<svg xmlns='http://www.w3.org/2000/svg' width='300' height='300'><rect width='100%' height='100%' fill='%23ffe1ee'/><text x='50%' y='50%' dominant-baseline='middle' text-anchor='middle' font-family='sans-serif' font-size='18' fill='%23ff6fa6'>No cover</text></svg>`);
      img.src = `data:image/svg+xml,${svg}`;
    }

    // ===== Lock screen =====
    const SECRET = 'Khadeja_Has_My_Heart';
    const gateWrap = document.getElementById('gateWrap');
    const appShell = document.getElementById('appShell');
    const cuteFooter = document.getElementById('cuteFooter');
    function showGate(){ gateWrap.style.display='flex'; appShell.style.display='none'; cuteFooter.style.display='none'; }
    function showApp(){ gateWrap.style.display='none'; appShell.style.display='flex'; }
    function unlock(){
      const val = document.getElementById('codeField').value.trim();
      if(val === SECRET){ showApp(); initHub(); }
      else document.getElementById('gateMsg').textContent = 'Wrong code ‚Äî try again.';
    }
    showGate();
    document.getElementById('submitCode').addEventListener('click', unlock);
    document.getElementById('codeField').addEventListener('keydown', e=>{ if(e.key==='Enter'){ e.preventDefault(); unlock(); } });

    // ===== Animated background =====
    const bg = document.getElementById('floatingBg');
    const symbols = ['üíñ','üíû','üíò','‚ú®','üåü','üí´'];
    for(let i=0;i<80;i++){
      const s=document.createElement('span');
      s.textContent=symbols[Math.floor(Math.random()*symbols.length)];
      s.style.left=Math.random()*100+'%';
      s.style.top=Math.random()*100+'%';
      s.style.fontSize=12+Math.random()*24+'px';
      s.style.animationDuration=5+Math.random()*6+'s';
      bg.appendChild(s);
    }

    // ===== Firebase init =====
    const firebaseConfig = {
      apiKey: "AIzaSyD7Rt9RFyk6DHsaqB_2KIv0QBGPGXYrWPo",
      authDomain: "notes-8d314.firebaseapp.com",
      databaseURL: "https://notes-8d314-default-rtdb.firebaseio.com",
      projectId: "notes-8d314",
      storageBucket: "notes-8d314.firebasestorage.app",
      messagingSenderId: "46616929171",
      appId: "1:46616929171:web:c3981641b271d3e33b3e66"
    };
    firebase.initializeApp(firebaseConfig);
    firebase.auth().signInAnonymously().catch(console.error);
    let CURRENT_UID = null;
    firebase.auth().onAuthStateChanged(user => { if (user) CURRENT_UID = user.uid; });
    const db = firebase.database();
    const ROOM_ID = 'for-khadeja';

    // ===== Build Hub + Pages =====
    function initHub(){
      appShell.innerHTML = `
        <section class="hub">
          <h1 class="title">Welcome, my love üíû</h1>
          <p class="subtitle">Check these sections Mon Amour ‚ú®</p>
          <div class="bigBtns">
            <div class="bigBtn" onclick="openPage('notes')">üíå
              <div class="label">Notes</div>
              <div class="desc">Write anything you desire to tell me here, Khadeja my lovee</div>
            </div>
            <div class="bigBtn" onclick="openPage('songs')">üéµ
              <div class="label">Songs</div>
              <div class="desc">Songs that remind me of usss</div>
            </div>
            <div class="bigBtn" onclick="openPage('photos')">üì∏
              <div class="label">Photos</div>
              <div class="desc">Our memories togetherr</div>
            </div>
          </div>
        </section>
        <main>
          <!-- NOTES PAGE (Realtime + secure delete) -->
          <section id="notes" class="page">
            <div class="backRow"><button class="backBtn" onclick="openPage('hub')">‚Üê Back</button></div>
            <div class="noteInputRow">
              <input id="noteContent" placeholder="Write a note" autocomplete="off" autocorrect="off" spellcheck="false" />
              <button class="btn" id="addNoteBtn">Pin Note</button>
            </div>
            <div class="notesBoard" id="notesBoard"></div>
          </section>

          <!-- SONGS PAGE -->
          <section id="songs" class="page">
            <div class="backRow"><button class="backBtn" onclick="openPage('hub')">‚Üê Back</button></div>
            <div class="songsGrid" id="songsGrid"></div>

            <!-- Custom Audio Player -->
            <div class="audioWrap">
              <div id="ap" class="audioPlayer">
                <div class="ap-cover"><img id="apCover" alt="cover" src="" onerror="this.src='songs/covers/3005.jpg'"></div>
                <div class="ap-main">
                  <div class="ap-title" id="apTitle">Pick a song</div>
                  <div class="ap-bar" id="apBar"><div class="ap-fill" id="apFill"></div></div>
                  <div class="ap-time"><span id="apNow">0:00</span> ‚Ä¢ <span id="apDur">0:00</span></div>
                </div>
                <div class="ap-ctrls">
                  <button id="apPrev" class="ap-btn">‚èÆ</button>
                  <button id="apPlay" class="ap-btn">‚ñ∫</button>
                  <button id="apNext" class="ap-btn">‚è≠</button>
                </div>
              </div>
            </div>

            <!-- Hidden native audio (we control it) -->
            <audio id="player" style="display:none"></audio>
          </section>

          <!-- PHOTOS PAGE with two sub-sections -->
          <section id="photos" class="page">
            <div class="backRow"><button class="backBtn" onclick="openPage('hub')">‚Üê Back</button></div>
            <div class="photoCats" id="photoCats">
              <div class="photoBtn" onclick="openPhotoCat('calls')">üì±
                <div class="label">Calls</div>
                <div class="desc">Us being togetherrr on call</div>
              </div>
              <div class="photoBtn" onclick="openPhotoCat('irl')">ü§ç
                <div class="label">Real Life</div>
                <div class="desc">Photos from when we were together in real life.</div>
              </div>
            </div>
            <div class="photosWall" id="photosWall" style="display:none">
              <div style="text-align:center;margin-bottom:10px"><button class="backBtn" onclick="closePhotoCat()">‚Üê Back to photo categories</button></div>
              <div class="polaroidGrid" id="polaroidGrid"></div>
            </div>
          </section>
        </main>`;

      // Show hub + footer decorations
      openPage('hub');
      cuteFooter.style.display = 'flex';

// ===== NOTES logic (text only, realtime) =====
const notesBoard = document.getElementById('notesBoard');
const addBtn = document.getElementById('addNoteBtn');
const input  = document.getElementById('noteContent');

// When adding a new note
addBtn.addEventListener('click', ()=>{
  const v = input.value.trim();
  if(!v) return;
  db.ref(`rooms/${ROOM_ID}/notes`).push({
    type:'text',
    text:v,
    time:Date.now(),
    uid: CURRENT_UID || null
  });
  input.value='';
});

// Realtime listener for notes
db.ref(`rooms/${ROOM_ID}/notes`).on('value', (snapshot) => {
  notesBoard.innerHTML = '';
  const data = snapshot.val();
  if (!data) return;

  const entries = Object.entries(data).sort((a,b)=>(b[1].time||0)-(a[1].time||0));
  for (const [key, n] of entries) {
    const card = document.createElement('div');
    card.className = 'noteCard';
    card.style.setProperty('--r', (Math.random()*0.8 - 0.4).toFixed(2));
    const dateStr = new Date(n.time||Date.now()).toLocaleString('en-US', { dateStyle: 'medium', timeStyle: 'short' });

    card.innerHTML = `
      <span class="pin" aria-hidden="true"></span>
      <div class="noteBody"><p>${escapeHtml(n.text||'')}</p></div>
      <div class="noteFooter">
        <small>Added on ${dateStr}</small>
      </div>`;
    notesBoard.appendChild(card);
  }
});

      // ===== SONGS behavior (your actual files/covers) =====
      const songs = [
        { file: 'songs/K.mp3',        cover:'songs/covers/K..jpg',       title:'K.',            artist:'Cigarettes After Sex' },
        { file: 'songs/RightOne.mp3', cover:'songs/covers/rightone.jpg', title:'The Right One', artist:'Sports' },
        { file: 'songs/3005.mp3',     cover:'songs/covers/3005.jpg',     title:'3005',          artist:'Childish Gambino' }
      ];
      const songsGrid = document.getElementById('songsGrid');
      const player    = document.getElementById('player');

      // Build song cards
      songs.forEach((s, idx)=>{
        const card = document.createElement('div');
        card.className = 'songCard';
        card.innerHTML = `
          <div class="cover"><img src="${s.cover}" alt="${s.title} cover" onerror="coverFallback(this)"></div>
          <div class="songTitle">${s.title}</div>
          <div style="color:#885">${s.artist}</div>
          <button class="playBtn">Play</button>`;
        card.querySelector('.playBtn').addEventListener('click',()=>{ loadSong(idx, true); });
        songsGrid.appendChild(card);
      });

      // Custom player state
      const ap = {
        audio: player,
        title: document.getElementById('apTitle'),
        now:   document.getElementById('apNow'),
        dur:   document.getElementById('apDur'),
        bar:   document.getElementById('apBar'),
        fill:  document.getElementById('apFill'),
        play:  document.getElementById('apPlay'),
        prev:  document.getElementById('apPrev'),
        next:  document.getElementById('apNext'),
        cover: document.getElementById('apCover'),
        i: -1
      };

      function fmt(t){ if(!isFinite(t)) return '0:00'; const m=Math.floor(t/60); const s=Math.floor(t%60); return `${m}:${s.toString().padStart(2,'0')}`; }
      function loadSong(i, autoplay=false){
        ap.i = i;
        const s = songs[i];
        ap.audio.src = s.file;
        ap.title.textContent = `${s.title} ‚Äî ${s.artist}`;
        ap.cover.src = s.cover;
        if(autoplay){ ap.audio.play().then(()=>ap.play.textContent='‚ùö‚ùö').catch(()=>{}); }
      }
      function playPause(){
        if(ap.audio.paused){ ap.audio.play().then(()=>ap.play.textContent='‚ùö‚ùö'); }
        else { ap.audio.pause(); ap.play.textContent='‚ñ∫'; }
      }
      ap.play.addEventListener('click', playPause);
      ap.prev.addEventListener('click', ()=>{ const ni = (ap.i<=0? songs.length-1 : ap.i-1); loadSong(ni, true); });
      ap.next.addEventListener('click', ()=>{ const ni = (ap.i>=songs.length-1? 0 : ap.i+1); loadSong(ni, true); });

      ap.audio.addEventListener('timeupdate', ()=>{
        ap.fill.style.width = ((ap.audio.currentTime/(ap.audio.duration||1))*100)+'%';
        ap.now.textContent = fmt(ap.audio.currentTime);
        ap.dur.textContent = fmt(ap.audio.duration);
      });
      ap.bar.addEventListener('click', (e)=>{
        const r = ap.bar.getBoundingClientRect();
        const ratio = (e.clientX - r.left) / r.width;
        ap.audio.currentTime = ratio * (ap.audio.duration||0);
      });
      ap.audio.addEventListener('ended', ()=> ap.next.click());

      // ===== PHOTOS behavior (two categories with polaroids) =====
      const photoSets = {
        calls: [
          'photos/calls/IMG1.jpg',
          'photos/calls/IMG2.jpg',
          'photos/calls/IMG3.jpg',
          'photos/calls/IMG4.jpg',
          'photos/calls/IMG5.jpg',
          'photos/calls/IMG6.jpg',
          'photos/calls/IMG7.jpg',
          'photos/calls/IMG8.jpg',
          'photos/calls/IMG9.JPG',
          'photos/calls/IMG10.JPG',
          'photos/calls/VID1.mp4',

        ],
        irl: [
          'photos/realLife/IMG1.jpg',
          'photos/realLife/IMG2.jpg',
          'photos/realLife/IMG3.jpg',
          'photos/realLife/IMG4.jpg',
          'photos/realLife/IMG5.jpg',
          'photos/realLife/IMG6.jpg',
          'photos/realLife/VID1.mp4'
        ]
      };

      window.openPhotoCat = function(cat){
        document.getElementById('photoCats').style.display='none';
        const wall = document.getElementById('photosWall');
        wall.style.display='block';
        const grid = document.getElementById('polaroidGrid');
        grid.innerHTML = '';
        (photoSets[cat]||[]).forEach((src,idx)=>{
          const p = document.createElement('div');
          p.className = 'polaroid';
          p.style.setProperty('--rot', (Math.random()*2-1).toFixed(2));
          const isVideo = /\.(mp4|webm|ogg)$/i.test(src);
          p.innerHTML = isVideo
            ? `<span class="pin" aria-hidden="true"></span><video src="${src}" controls playsinline></video>`
            : `<span class="pin" aria-hidden="true"></span><img src="${src}" alt="memory ${idx+1}">`;

          const media = p.querySelector(isVideo ? 'video' : 'img');
          media.style.cursor = 'zoom-in';
          media.addEventListener('click', ()=> openLightbox(src, isVideo));
          grid.appendChild(p);
        });
      }
      window.closePhotoCat = function(){
        document.getElementById('photosWall').style.display='none';
        document.getElementById('photoCats').style.display='flex';
        document.getElementById('polaroidGrid').innerHTML='';
      }
    }

    function openPage(p){
      document.querySelectorAll('.hub, .page').forEach(el=>el.style.display='none');
      if(p==='hub'){ document.querySelector('.hub').style.display='flex'; cuteFooter.style.display='flex'; }
      else { document.getElementById(p).style.display='block'; cuteFooter.style.display='none'; }
    }

    // Lightbox helpers
    function openLightbox(src, isVideo){
      const lb = document.getElementById('lightbox');
      const box = document.getElementById('lbContent');
      box.innerHTML = '';
      if(isVideo){
        const v = document.createElement('video');
        v.src = src; v.controls = true; v.playsInline = true; v.style.maxWidth = '100%'; v.style.maxHeight = '70vh';
        box.appendChild(v);
      }else{
        const img = new Image();
        img.src = src; img.alt = 'memory';
        img.style.maxWidth = '100%'; img.style.maxHeight = '70vh';
        box.appendChild(img);
      }
      lb.style.display = 'flex';
    }
    (function(){
      const lb = document.getElementById('lightbox');
      const close = document.getElementById('lbClose');
      close.addEventListener('click', ()=> lb.style.display='none');
      lb.addEventListener('click', (e)=>{ if(e.target === lb) lb.style.display='none'; });
      document.addEventListener('keydown', (e)=>{ if(e.key==='Escape') lb.style.display='none'; });
    })();

    // ===== Minimal self-tests =====
    (function(){
      try{
        console.assert(escapeHtml('a&b')==='a&amp;b','& escaping failed');
        console.assert(escapeHtml('<>')==='&lt;&gt;','angle escaping failed');
        console.assert(escapeHtml('x\ny').includes('<br>'),'newline to <br> failed');
        console.assert(typeof unlock==='function','unlock not defined');
        console.log('[Self-tests] OK');
      }catch(e){ console.error('[Self-tests] FAIL', e); }
    })();
  </script>
</body>
</html>


